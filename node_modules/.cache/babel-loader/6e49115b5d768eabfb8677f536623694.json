{"remainingRequest":"/Users/circle/Desktop/vue-music/node_modules/babel-loader/lib/index.js!/Users/circle/Desktop/vue-music/node_modules/eslint-loader/index.js??ref--13-0!/Users/circle/Desktop/vue-music/src/api/song.js","dependencies":[{"path":"/Users/circle/Desktop/vue-music/src/api/song.js","mtime":1574170630918},{"path":"/Users/circle/Desktop/vue-music/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/circle/Desktop/vue-music/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/circle/Desktop/vue-music/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Object$keys from \"/Users/circle/Desktop/vue-music/node_modules/@babel/runtime-corejs2/core-js/object/keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _Promise from \"/Users/circle/Desktop/vue-music/node_modules/@babel/runtime-corejs2/core-js/promise\";\nimport _Object$assign from \"/Users/circle/Desktop/vue-music/node_modules/@babel/runtime-corejs2/core-js/object/assign\";\nimport { commonParams } from './config';\nimport { getUid } from 'common/js/uid';\nimport axios from 'axios';\nimport { ERR_OK } from 'api/config';\nvar debug = process.env.NODE_ENV !== 'production';\nexport function getLyric(mid) {\n  var url = debug ? '/api/lyric' : 'http://ustbhuangyi.com/music/api/lyric';\n\n  var data = _Object$assign({}, commonParams, {\n    songmid: mid,\n    platform: 'yqq',\n    hostUin: 0,\n    needNewCode: 0,\n    categoryId: 10000000,\n    pcachetime: +new Date(),\n    format: 'json'\n  });\n\n  return axios.get(url, {\n    params: data\n  }).then(function (res) {\n    return _Promise.resolve(res.data);\n  });\n}\nexport function getSongsUrl(songs) {\n  var url = debug ? '/api/getPurlUrl' : 'http://ustbhuangyi.com/music/api/getPurlUrl';\n  var mids = [];\n  var types = [];\n  songs.forEach(function (song) {\n    mids.push(song.mid);\n    types.push(0);\n  });\n  var urlMid = genUrlMid(mids, types);\n\n  var data = _Object$assign({}, commonParams, {\n    g_tk: 5381,\n    format: 'json',\n    platform: 'h5',\n    needNewCode: 1,\n    uin: 0\n  });\n\n  return new _Promise(function (resolve, reject) {\n    var tryTime = 3;\n\n    function request() {\n      return axios.post(url, {\n        comm: data,\n        req_0: urlMid\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.code === ERR_OK) {\n          var _urlMid = res.req_0;\n\n          if (_urlMid && _urlMid.code === ERR_OK) {\n            var purlMap = {};\n\n            _urlMid.data.midurlinfo.forEach(function (item) {\n              if (item.purl) {\n                purlMap[item.songmid] = item.purl;\n              }\n            });\n\n            if (_Object$keys(purlMap).length > 0) {\n              resolve(purlMap);\n            } else {\n              retry();\n            }\n          } else {\n            retry();\n          }\n        } else {\n          retry();\n        }\n      });\n    }\n\n    function retry() {\n      if (--tryTime >= 0) {\n        request();\n      } else {\n        reject(new Error('Can not get the songs url'));\n      }\n    }\n\n    request();\n  });\n}\n\nfunction genUrlMid(mids, types) {\n  var guid = getUid();\n  return {\n    module: 'vkey.GetVkeyServer',\n    method: 'CgiGetVkey',\n    param: {\n      guid: guid,\n      songmid: mids,\n      songtype: types,\n      uin: '0',\n      loginflag: 0,\n      platform: '23'\n    }\n  };\n}",{"version":3,"sources":["/Users/circle/Desktop/vue-music/src/api/song.js"],"names":["commonParams","getUid","axios","ERR_OK","debug","process","env","NODE_ENV","getLyric","mid","url","data","songmid","platform","hostUin","needNewCode","categoryId","pcachetime","Date","format","get","params","then","res","resolve","getSongsUrl","songs","mids","types","forEach","song","push","urlMid","genUrlMid","g_tk","uin","reject","tryTime","request","post","comm","req_0","response","code","purlMap","midurlinfo","item","purl","length","retry","Error","guid","module","method","param","songtype","loginflag"],"mappings":"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","sourcesContent":["import { commonParams } from './config'\nimport { getUid } from 'common/js/uid'\nimport axios from 'axios'\nimport { ERR_OK } from 'api/config'\n\nconst debug = process.env.NODE_ENV !== 'production'\n\nexport function getLyric (mid) {\n  const url = debug ? '/api/lyric' : 'http://ustbhuangyi.com/music/api/lyric'\n\n  const data = Object.assign({}, commonParams, {\n    songmid: mid,\n    platform: 'yqq',\n    hostUin: 0,\n    needNewCode: 0,\n    categoryId: 10000000,\n    pcachetime: +new Date(),\n    format: 'json'\n  })\n\n  return axios.get(url, {\n    params: data\n  }).then((res) => {\n    return Promise.resolve(res.data)\n  })\n}\n\nexport function getSongsUrl (songs) {\n  const url = debug ? '/api/getPurlUrl' : 'http://ustbhuangyi.com/music/api/getPurlUrl'\n\n  let mids = []\n  let types = []\n\n  songs.forEach((song) => {\n    mids.push(song.mid)\n    types.push(0)\n  })\n\n  const urlMid = genUrlMid(mids, types)\n\n  const data = Object.assign({}, commonParams, {\n    g_tk: 5381,\n    format: 'json',\n    platform: 'h5',\n    needNewCode: 1,\n    uin: 0\n  })\n\n  return new Promise((resolve, reject) => {\n    let tryTime = 3\n\n    function request () {\n      return axios.post(url, {\n        comm: data,\n        req_0: urlMid\n      }).then((response) => {\n        const res = response.data\n        if (res.code === ERR_OK) {\n          let urlMid = res.req_0\n          if (urlMid && urlMid.code === ERR_OK) {\n            const purlMap = {}\n            urlMid.data.midurlinfo.forEach((item) => {\n              if (item.purl) {\n                purlMap[item.songmid] = item.purl\n              }\n            })\n            if (Object.keys(purlMap).length > 0) {\n              resolve(purlMap)\n            } else {\n              retry()\n            }\n          } else {\n            retry()\n          }\n        } else {\n          retry()\n        }\n      })\n    }\n\n    function retry () {\n      if (--tryTime >= 0) {\n        request()\n      } else {\n        reject(new Error('Can not get the songs url'))\n      }\n    }\n\n    request()\n  })\n}\n\nfunction genUrlMid (mids, types) {\n  const guid = getUid()\n  return {\n    module: 'vkey.GetVkeyServer',\n    method: 'CgiGetVkey',\n    param: {\n      guid,\n      songmid: mids,\n      songtype: types,\n      uin: '0',\n      loginflag: 0,\n      platform: '23'\n    }\n  }\n}\n"]}]}