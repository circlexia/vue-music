{"remainingRequest":"/Users/circle/Desktop/vue-music/node_modules/babel-loader/lib/index.js!/Users/circle/Desktop/vue-music/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/circle/Desktop/vue-music/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/circle/Desktop/vue-music/src/components/suggest/suggest.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/circle/Desktop/vue-music/src/components/suggest/suggest.vue","mtime":1574170630927},{"path":"/Users/circle/Desktop/vue-music/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/circle/Desktop/vue-music/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/circle/Desktop/vue-music/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/circle/Desktop/vue-music/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"/Users/circle/Desktop/vue-music/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Scroll from 'base/scroll/scroll';\nimport Loading from 'base/loading/loading';\nimport NoResult from 'base/no-result/no-result';\nimport { search as _search } from 'api/search';\nimport { ERR_OK } from 'api/config';\nimport { createSong, isValidMusic, processSongsUrl } from 'common/js/song';\nimport { mapMutations, mapActions } from 'vuex';\nimport Singer from 'common/js/singer';\nvar TYPE_SINGER = 'singer';\nvar perpage = 20;\nexport default {\n  props: {\n    showSinger: {\n      type: Boolean,\n      default: true\n    },\n    query: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      page: 1,\n      pullup: true,\n      beforeScroll: true,\n      hasMore: true,\n      result: []\n    };\n  },\n  methods: _objectSpread({\n    refresh: function refresh() {\n      this.$refs.suggest.refresh();\n    },\n    search: function search() {\n      var _this = this;\n\n      this.page = 1;\n      this.hasMore = true;\n      this.$refs.suggest.scrollTo(0, 0);\n\n      _search(this.query, this.page, this.showSinger, perpage).then(function (res) {\n        if (res.code === ERR_OK) {\n          _this._genResult(res.data).then(function (result) {\n            _this.result = result;\n          });\n\n          _this._checkMore(res.data);\n        }\n      });\n    },\n    searchMore: function searchMore() {\n      var _this2 = this;\n\n      if (!this.hasMore) {\n        return;\n      }\n\n      this.page++;\n\n      _search(this.query, this.page, this.showSinger, perpage).then(function (res) {\n        if (res.code === ERR_OK) {\n          _this2._genResult(res.data).then(function (result) {\n            _this2.result = _this2.result.concat(result);\n          });\n\n          _this2._checkMore(res.data);\n        }\n      });\n    },\n    listScroll: function listScroll() {\n      this.$emit('listScroll');\n    },\n    selectItem: function selectItem(item) {\n      if (item.type === TYPE_SINGER) {\n        var singer = new Singer({\n          id: item.singermid,\n          name: item.singername\n        });\n        this.$router.push({\n          path: \"/search/\".concat(singer.id)\n        });\n        this.setSinger(singer);\n      } else {\n        this.insertSong(item);\n      }\n\n      this.$emit('select', item);\n    },\n    getDisplayName: function getDisplayName(item) {\n      if (item.type === TYPE_SINGER) {\n        return item.singername;\n      } else {\n        return \"\".concat(item.name, \"-\").concat(item.singer);\n      }\n    },\n    getIconCls: function getIconCls(item) {\n      if (item.type === TYPE_SINGER) {\n        return 'icon-mine';\n      } else {\n        return 'icon-music';\n      }\n    },\n    _genResult: function _genResult(data) {\n      var ret = [];\n\n      if (data.zhida && data.zhida.singerid && this.page === 1) {\n        ret.push(_objectSpread({}, data.zhida, {\n          type: TYPE_SINGER\n        }));\n      }\n\n      return processSongsUrl(this._normalizeSongs(data.song.list)).then(function (songs) {\n        ret = ret.concat(songs);\n        return ret;\n      });\n    },\n    _normalizeSongs: function _normalizeSongs(list) {\n      var ret = [];\n      list.forEach(function (musicData) {\n        if (isValidMusic(musicData)) {\n          ret.push(createSong(musicData));\n        }\n      });\n      return ret;\n    },\n    _checkMore: function _checkMore(data) {\n      var song = data.song;\n\n      if (!song.list.length || song.curnum + (song.curpage - 1) * perpage >= song.totalnum) {\n        this.hasMore = false;\n      }\n    }\n  }, mapMutations({\n    setSinger: 'SET_SINGER'\n  }), mapActions(['insertSong'])),\n  watch: {\n    query: function query(newQuery) {\n      if (!newQuery) {\n        return;\n      }\n\n      this.search(newQuery);\n    }\n  },\n  components: {\n    Scroll: Scroll,\n    Loading: Loading,\n    NoResult: NoResult\n  }\n};",{"version":3,"sources":["suggest.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <scroll ref=\"suggest\"\n          class=\"suggest\"\n          :data=\"result\"\n          :pullup=\"pullup\"\n          :beforeScroll=\"beforeScroll\"\n          @scrollToEnd=\"searchMore\"\n          @beforeScroll=\"listScroll\"\n  >\n    <ul class=\"suggest-list\">\n      <li @click=\"selectItem(item)\" class=\"suggest-item\" v-for=\"(item,index) in result\" :key=\"index\">\n        <div class=\"icon\">\n          <i :class=\"getIconCls(item)\"></i>\n        </div>\n        <div class=\"name\">\n          <p class=\"text\" v-html=\"getDisplayName(item)\"></p>\n        </div>\n      </li>\n      <loading v-show=\"hasMore\" title=\"\"></loading>\n    </ul>\n    <div v-show=\"!hasMore && !result.length\" class=\"no-result-wrapper\">\n      <no-result title=\"抱歉，暂无搜索结果\"></no-result>\n    </div>\n  </scroll>\n</template>\n\n<script type=\"text/ecmascript-6\">\n  import Scroll from 'base/scroll/scroll'\n  import Loading from 'base/loading/loading'\n  import NoResult from 'base/no-result/no-result'\n  import { search } from 'api/search'\n  import { ERR_OK } from 'api/config'\n  import { createSong, isValidMusic, processSongsUrl } from 'common/js/song'\n  import { mapMutations, mapActions } from 'vuex'\n  import Singer from 'common/js/singer'\n\n  const TYPE_SINGER = 'singer'\n  const perpage = 20\n\n  export default {\n    props: {\n      showSinger: {\n        type: Boolean,\n        default: true\n      },\n      query: {\n        type: String,\n        default: ''\n      }\n    },\n    data () {\n      return {\n        page: 1,\n        pullup: true,\n        beforeScroll: true,\n        hasMore: true,\n        result: []\n      }\n    },\n    methods: {\n      refresh () {\n        this.$refs.suggest.refresh()\n      },\n      search () {\n        this.page = 1\n        this.hasMore = true\n        this.$refs.suggest.scrollTo(0, 0)\n        search(this.query, this.page, this.showSinger, perpage).then((res) => {\n          if (res.code === ERR_OK) {\n            this._genResult(res.data).then((result) => {\n              this.result = result\n            })\n            this._checkMore(res.data)\n          }\n        })\n      },\n      searchMore () {\n        if (!this.hasMore) {\n          return\n        }\n        this.page++\n        search(this.query, this.page, this.showSinger, perpage).then((res) => {\n          if (res.code === ERR_OK) {\n            this._genResult(res.data).then((result) => {\n              this.result = this.result.concat(result)\n            })\n            this._checkMore(res.data)\n          }\n        })\n      },\n      listScroll () {\n        this.$emit('listScroll')\n      },\n      selectItem (item) {\n        if (item.type === TYPE_SINGER) {\n          const singer = new Singer({\n            id: item.singermid,\n            name: item.singername\n          })\n          this.$router.push({\n            path: `/search/${singer.id}`\n          })\n          this.setSinger(singer)\n        } else {\n          this.insertSong(item)\n        }\n        this.$emit('select', item)\n      },\n      getDisplayName (item) {\n        if (item.type === TYPE_SINGER) {\n          return item.singername\n        } else {\n          return `${item.name}-${item.singer}`\n        }\n      },\n      getIconCls (item) {\n        if (item.type === TYPE_SINGER) {\n          return 'icon-mine'\n        } else {\n          return 'icon-music'\n        }\n      },\n      _genResult (data) {\n        let ret = []\n        if (data.zhida && data.zhida.singerid && this.page === 1) {\n          ret.push({ ...data.zhida, ...{ type: TYPE_SINGER } })\n        }\n        return processSongsUrl(this._normalizeSongs(data.song.list)).then((songs) => {\n          ret = ret.concat(songs)\n          return ret\n        })\n      },\n      _normalizeSongs (list) {\n        let ret = []\n        list.forEach((musicData) => {\n          if (isValidMusic(musicData)) {\n            ret.push(createSong(musicData))\n          }\n        })\n        return ret\n      },\n      _checkMore (data) {\n        const song = data.song\n        if (!song.list.length || (song.curnum + (song.curpage - 1) * perpage) >= song.totalnum) {\n          this.hasMore = false\n        }\n      },\n      ...mapMutations({\n        setSinger: 'SET_SINGER'\n      }),\n      ...mapActions([\n        'insertSong'\n      ])\n    },\n    watch: {\n      query (newQuery) {\n        if (!newQuery) {\n          return\n        }\n        this.search(newQuery)\n      }\n    },\n    components: {\n      Scroll,\n      Loading,\n      NoResult\n    }\n  }\n</script>\n\n<style scoped lang=\"stylus\" rel=\"stylesheet/stylus\">\n  @import \"~common/stylus/variable\"\n  @import \"~common/stylus/mixin\"\n\n  .suggest\n    height: 100%\n    overflow: hidden\n    .suggest-list\n      padding: 0 30px\n      .suggest-item\n        display: flex\n        align-items: center\n        padding-bottom: 20px\n      .icon\n        flex: 0 0 30px\n        width: 30px\n        [class^=\"icon-\"]\n          font-size: 14px\n          color: $color-text-d\n      .name\n        flex: 1\n        font-size: $font-size-medium\n        color: $color-text-d\n        overflow: hidden\n        .text\n          no-wrap()\n    .no-result-wrapper\n      position: absolute\n      width: 100%\n      top: 50%\n      transform: translateY(-50%)\n</style>\n"],"sourceRoot":"src/components/suggest"}]}